---
Title: "Verifying TraTs"
weight: 3
toc: true
---

This guide details the steps to verify Transaction Tokens (TraTs) after successfully generating them as per the [Generating TraTs](/docs/quickstart/generating-trats) guide.

&nbsp;

- [Overview](#overview)

- [Accessing Tratteria's Public Key JSON Web Key Sets (JWKS)](#accessing-tratterias-public-key-json-web-key-sets-jwks)

- [Verifing TraTs](#verifing-trats)

&nbsp;

### Overview

TraTs are cryptographically signed by Tratteria's private key and are verifiable using Tratteria's public key.

&nbsp;

### Accessing Tratteria's Public Key JSON Web Key Sets (JWKS)

Tratteria's signing key can be generated seperately and supplied through the configuration, or if not provided, it is automatically generated by Tratteria. If you prefer to distribute the public key through your infrastructure, generating the key seperately can be convenient. For this, you can check out the [example application](https://github.com/SGNL-ai/tratteria/tree/main/example-application), which generates the key seperately and distributes the public key using its Kubernetes infrastructure.

However, in this quick-start guide, for simplicity, we did not generate the key ourselves, so the key is automatically generated by Tratteria.

For both supplied and automatically generated keys, the public key JSON Web Key Sets (JWKS) can be accessed at the `GET /.well-known/jwks.json` endpoint.


**Request to get Tratteria's public key:**

Perform the following request to get the public key JSON Web Key Set (JWKS):

```bash
curl http://localhost:9090/.well-known/jwks.json
```

You will get a response like the following:

```json
{
    "keys": [
        {
            "alg": "RS256",
            "e": "AQAB",
            "kid": "9wFmM6S/uPzH1A1jH8B8tg==",
            "kty": "RSA",
            "n": "19WcbY_iKzwoENjcPnkE7uHKUGhRNTe_TTjrHPudYZk-IpwoK9jRtPFdSjNwDOKzUbMHhmEcxyqWZVxk8ONsfz__U3ppaAqmIOypERhFnSmgxqtMf2beqoaQGB8CQb-luxB2vSI-vIKL2929y6MU_fOEOuSg1D00Rou-fYd104Wr5bpRV28rEIpVRaRnUFAUzJJItQh4CJ5tfh4x0uqv1POe9ZGSAhuxuVM-DbPQusbX84Fw-EJvJDGiDKguQ08eHmQHgPk-Mg6FXn7cTaEvpSn4t-81hDei-Ea65geCJyIjHHy5tb9KAvGQlPjRQGSkqb4xwidjxGoEADXR_XVfTQ",
            "use": "sig"
        }
    ]
}
```

&nbsp;

### Verifing TraTs

First, let's review the TraT we generated in the [Generating TraTs](/docs/quickstart/generating-trats) guide. Below is the TraT we received:

**JWT:**

```plaintext
eyJhbGciOiJSUzI1NiIsImtpZCI6IlFOVkVUMTh5ZStRT0UvdVVsa1hFa3c9PSIsInR5cCI6InR4bl90b2tlbiJ9.eyJhdWQiOiJodHRwczovL2V4YW1wbGUub3JnLyIsImF6ZCI6eyJhY3Rpb24iOiJCdXkiLCJxdWFudGl0eSI6NSwic3RvY2siOiJOQVNEQVE6TVNGVCJ9LCJleHAiOjE3MTUyMzAxMzMsImlhdCI6MTcxNTIzMDExOCwiaXNzIjoiaHR0cHM6Ly9leGFtcGxlLm9yZy90dHMiLCJwdXJwIjoic3RvY2tzLnRyYWRlIiwicmN0eCI6eyJyZXFfaXAiOiIxOTIuMTI4LjAuODkifSwic3ViIjp7ImVtYWlsIjoic2hlcmxvY2tAZGV0ZWN0LmNvbSIsImZvcm1hdCI6ImVtYWlsIn0sInR4biI6ImUzNDAyNWI5LTI2MjQtNGY1ZC1iZDFhLTgzZGVmODM3OWViZSJ9.kse_HrxLxgI583Z5uez3jBX5ylgR7oFTSwCIv5zsuYGGiBpDn-OBPmvEVyxIcT2dZC5WD82AMRjUrTy4wFquZReeuIxminMTqocWBl2v4Pu8uLvcEnH-Tv9qa8MtgXcU0a-xELWGulqe2UAUv_3Mi0Wb20QMgURcFaFcT7ccZXX_xHsrsboKavS7H_bWhEcwR3FvXKt1YwY3zDXiUHZaxjqGTqrv0V8wDFSZmnVFapT5RRH2tarYOmuKwv3MbdaXT0ZHBvQ2S2fBzOZ47WaTiTv9sKB-N8am94J3I_bo15dCauOm_bXZGT5ybbuBAp23D3297ARIYl74Xf_MJcapKA
```

**Payload:**

```json
{
  "aud": "https://example.org/",
  "azd": {
    "action": "Buy",
    "quantity": 5,
    "stock": "NASDAQ:MSFT"
  },
  "exp": 1715230133,
  "iat": 1715230118,
  "iss": "https://example.org/tts",
  "purp": "stocks.trade",
  "rctx": {
    "req_ip": "192.128.0.89"
  },
  "sub": {
    "email": "sherlock@detect.com",
    "format": "email"
  },
  "txn": "e34025b9-2624-4f5d-bd1a-83def8379ebe"
}
```

Verification of TraTs involves validating both its signature and claims. 


#### Verifying Signature

Signature verification ensures the token is from Tratteria and has not been altered. For this guide, we can verify the signature using the obtained JWKS from the `GET .well-known/jwks.json` endpoint with tools like [jwt.io](https://jwt.io/) or other available methods. For [jwt.io](https://jwt.io/), input the key from the JWKS keys list, i.e `{"keys":[`***`{this-section}`***`]}` in the verify signature section.


#### Verifying Claims

TraT contains the following verifiable claims:

**iss**

The issuer should match the Tratteria issuer value. In the generated TraT, we received `https://example.org/tts` as the issuer, which is the correct value as configured in the quick-start configuration.

**aud**

The audience should match the trust domain of your application. In the generated TraT, we received `https://example.org/` as the audience, which is the correct value as configured in the quick-start configuration.

**iat**

The issued at time. This should not be in the future.

**exp**

The expiration time. This should not be in the past.

**sub**

The identifier of the individual, entity, or user involved in the transaction. In the generated TraT, we received the following `sub` claim:

```json
  "sub": {
    "format": "email",
    "email": "sherlock@detect.com"
  },
```

Verifying the subject involves ensuring that the subject of the TraT matches the subject of the request.

**azd**

Authorization context of the transaction. In the generated TraT, we received the following `adz` claim:

```json
  "azd": {
    "action": "Buy",
    "quantity": 5,
    "stock": "NASDAQ:MSFT"
  },
```

Validating the authorization context involves comparing the TraT's `azd` JSON claims against the parameters of the received request. For instance, if the request specifies Microsoft as the stock parameter, then the same should be there in the parameters present in the `adz` JSON.

**rctx**

The request context provides details about the environmental context of the request, including the IP address, authentication method, and workloads involved in the request chain. In the generated TraT, we received the following `rctx` claim:

```json
{
  "rctx": {
    "req_ip": "192.128.0.89",
    "authn": "urn:ietf:params:oauth:token-type:self_signed",
    "req_wl": ["apigateway.example.org"]
  }
}
```

Verifying request context involves the following:

**req_ip**

Originating user IP address. Depending on your application or requirements, you can validate the IP address against rules such as the correct IP range.

**authn**

This denotes the method used to authenticate the requester. You should confirm that the authentication method used is acceptable. In this instance, we received `urn:ietf:params:oauth:token-type:self_signed`, indicating that the subject token is self-signed, which is the correct authn value for the quick-start configuration.

**req_wl**

These are the workloads that have requested this TraT. Using this list you should ensure that the request has passed through the approved and required services, thereby maintaining the integrity of the call chain.

&nbsp;

As an application developer, you should verify both the signature and the claims before processing the request. You can use [this library](#) to verify TraTs. Currently, the library is only available in Go.

&nbsp;

This quick start guide provides the basic steps to get Tratteria up and running for initial learning and evaluation purposes. Remember to adjust the configurations as per the requirements for any setup beyond initial evaluations. Check [this guide](#) for detailed instructions on configuring and integrating production-level Tratteria.
