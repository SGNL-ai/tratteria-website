
<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script async src="https://cse.google.com/cse.js?cx=315531be7c52f5156"></script>
    <title>
      
        Tratteria
      
    </title>
    <link rel="stylesheet" href="/css/style.1df9f62415d297f5c54d2fc02d71b1b122e108253802ae8fa49b752f0120f199.css" integrity="sha256-Hfn2JBXSl/XFTS/ALXGxsSLhCCU4Aq6PpJt1LwEg8Zk=">

    


<link rel="shortcut icon" href="/favicon.svg">


    
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
<script src="/js/app.09103495742f46957c0ccfe21325d1eb09374faea4d172abd0531e9d9fe6ea17.js" type="module" integrity="sha256-CRA0lXQvRpV8DM/iEyXR6wk3T66k0XKr0FMenZ/m6hc="></script>


  </head>

    <body>
      






<div class="navbar navbar-expand-lg navbar-light bg-light sticky-top" role="navigation" aria-label="main navigation">
  <div class="container nav-container">
    <div class="navbar-brand">
      <a class="navbar-item text-hide" href="https://tratteria.io/">
        Tratteria
        
        
          <img src="/img/logos/text-image-logo.svg" class="logo">
        
      </a>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="main-nav">
      <ul class="navbar-nav mr-auto">
        
        
        
        <li class="navbar-start navbar-item">
          
          <a class="nav-link" href="/">
            Home
          </a>
          
        
        <li class="navbar-start navbar-item">
          
          <a class="nav-link" href="/docs/">
            Documentation
          </a>
          
        </li>
        
      </ul>
      <div class="gcse-search"></div>
    </div>
  </div> 
</div>

    <main class="content">
      
  <header>
    <div>
      <div class="container mt-4 mb-4 pb-2">
  <section class="row">
      
          

<div class="col col-11 breadcrumb" aria-label="breadcrumbs">
  <ul class="mb-0 pt-2" style="vertical-align: middle">
    

  

  

  



<li >
  / <a href="/">
    Home
  </a>
</li>




<li >
  / <a href="/docs/">
    Introduction to Tratteria
  </a>
</li>




<li >
  / <a href="/docs/quickstart/">
    Quickstart Guide for Tratteria
  </a>
</li>




<li  class="is-active">
  / <a href="/docs/quickstart/verifying-trats/">
    Verifying TraTs
  </a>
</li>

  </ul>
</div>

          <div>
    
    
    
    <a href="https://github.com/SGNL-ai/tratteria-website/blob/main/content/docs/quickstart/verifying-trats.md" class="btn btn-primary" target="_blank">
      <i class="fas fa-pen"></i>
    </a>
</div>

      
  </section>
</section>
</div>

    </div>
  </header>
  <div class="container">
      <section class="row">        
        <section class="col">
           
 
 




<nav class="section-nav">
      <p class="menu-label open" id="leftnavToggle">Documentation:</p>      
      <ul class="menu-list" id="leftnav">
        <li><a  href="/docs/">Introduction to Tratteria</a>
        
        </li>
    
        <li><a  href="/docs/quickstart/">Quickstart Guide for Tratteria</a>
          <ul>
            
            <li>
                <a  href="/docs/quickstart/running-tratteria/">Running Tratteria</a>
            </li>
            
            <li>
                <a  href="/docs/quickstart/generating-trats/">Generating TraTs</a>
            </li>
            
            <li>
                <a  href="/docs/quickstart/verifying-trats/">Verifying TraTs</a>
            </li>
            
          </ul>
        </li>
    
        <li><a  href="/docs/configuration/">Configuration Guide</a>
          <ul>
            
          </ul>
        </li>
    
        <li><a  href="/docs/integration/">Integration Guide</a>
          <ul>
            
          </ul>
        </li>
    
        <li><a  href="/docs/txn-token-format/">TraT Format</a>
          <ul>
            
          </ul>
        </li>
    
        <li><a  href="/docs/replacement-txn-token/">Replacement TraTs</a>
          <ul>
            
          </ul>
        </li>
    
        <li><a  href="/docs/call-chain-verification/">Call Chain Verification</a>
          <ul>
            
          </ul>
        </li>
    
        <li><a  href="/docs/access-evaluation/">Access Evaluation</a>
          <ul>
            
          </ul>
        </li>
    

</nav>

        </section>
        <section class="col col-8">
          <h1 class="title">Verifying TraTs</h1>
          <p class="subtitle"></p>
          
<div class="content">
  <p>This guide details the steps to verify Transaction Tokens (TraTs) after successfully generating them as per the <a href="/docs/quickstart/generating-trats">Generating TraTs</a> guide.</p>
<p> </p>
<ul>
<li>
<p><a href="#overview">Overview</a></p>
</li>
<li>
<p><a href="#accessing-tratterias-public-key-json-web-key-sets-jwks">Accessing Tratteria&rsquo;s Public Key JSON Web Key Sets (JWKS)</a></p>
</li>
<li>
<p><a href="#verifing-trats">Verifing TraTs</a></p>
</li>
</ul>
<p> </p>
<h3 id="overview">
  Overview
  <a href="#overview">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h3>
<p>TraTs are cryptographically signed by Tratteria&rsquo;s private key and are verifiable using Tratteria&rsquo;s public key.</p>
<p> </p>
<h3 id="accessing-tratterias-public-key-json-web-key-sets-jwks">
  Accessing Tratteria&rsquo;s Public Key JSON Web Key Sets (JWKS)
  <a href="#accessing-tratterias-public-key-json-web-key-sets-jwks">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h3>
<p>Tratteria&rsquo;s signing key can be generated seperately and supplied through the configuration, or if not provided, it is automatically generated by Tratteria. If you prefer to distribute the public key through your infrastructure, generating the key seperately can be convenient. For this, you can check out the <a href="https://github.com/SGNL-ai/tratteria/tree/main/example-application" target="_blank" rel="noopener">example application</a>, which generates the key seperately and distributes the public key using its Kubernetes infrastructure.</p>
<p>However, in this quick-start guide, for simplicity, we did not generate the key ourselves, so the key is automatically generated by Tratteria.</p>
<p>For both supplied and automatically generated keys, the public key JSON Web Key Sets (JWKS) can be accessed at the <code>GET /.well-known/jwks.json</code> endpoint.</p>
<p><strong>Request to get Tratteria&rsquo;s public key:</strong></p>
<p>Perform the following request to get the public key JSON Web Key Set (JWKS):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl http://localhost:9090/.well-known/jwks.json
</span></span></code></pre></div><p>You will get a response like the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;keys&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;alg&#34;</span>: <span style="color:#e6db74">&#34;RS256&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;e&#34;</span>: <span style="color:#e6db74">&#34;AQAB&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;kid&#34;</span>: <span style="color:#e6db74">&#34;9wFmM6S/uPzH1A1jH8B8tg==&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;kty&#34;</span>: <span style="color:#e6db74">&#34;RSA&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;n&#34;</span>: <span style="color:#e6db74">&#34;19WcbY_iKzwoENjcPnkE7uHKUGhRNTe_TTjrHPudYZk-IpwoK9jRtPFdSjNwDOKzUbMHhmEcxyqWZVxk8ONsfz__U3ppaAqmIOypERhFnSmgxqtMf2beqoaQGB8CQb-luxB2vSI-vIKL2929y6MU_fOEOuSg1D00Rou-fYd104Wr5bpRV28rEIpVRaRnUFAUzJJItQh4CJ5tfh4x0uqv1POe9ZGSAhuxuVM-DbPQusbX84Fw-EJvJDGiDKguQ08eHmQHgPk-Mg6FXn7cTaEvpSn4t-81hDei-Ea65geCJyIjHHy5tb9KAvGQlPjRQGSkqb4xwidjxGoEADXR_XVfTQ&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;use&#34;</span>: <span style="color:#e6db74">&#34;sig&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p> </p>
<h3 id="verifing-trats">
  Verifing TraTs
  <a href="#verifing-trats">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h3>
<p>First, let&rsquo;s review the TraT we generated in the <a href="/docs/quickstart/generating-trats">Generating TraTs</a> guide. Below is the TraT we received:</p>
<p><strong>JWT:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>eyJhbGciOiJSUzI1NiIsImtpZCI6IlFOVkVUMTh5ZStRT0UvdVVsa1hFa3c9PSIsInR5cCI6InR4bl90b2tlbiJ9.eyJhdWQiOiJodHRwczovL2V4YW1wbGUub3JnLyIsImF6ZCI6eyJhY3Rpb24iOiJCdXkiLCJxdWFudGl0eSI6NSwic3RvY2siOiJOQVNEQVE6TVNGVCJ9LCJleHAiOjE3MTUyMzAxMzMsImlhdCI6MTcxNTIzMDExOCwiaXNzIjoiaHR0cHM6Ly9leGFtcGxlLm9yZy90dHMiLCJwdXJwIjoic3RvY2tzLnRyYWRlIiwicmN0eCI6eyJyZXFfaXAiOiIxOTIuMTI4LjAuODkifSwic3ViIjp7ImVtYWlsIjoic2hlcmxvY2tAZGV0ZWN0LmNvbSIsImZvcm1hdCI6ImVtYWlsIn0sInR4biI6ImUzNDAyNWI5LTI2MjQtNGY1ZC1iZDFhLTgzZGVmODM3OWViZSJ9.kse_HrxLxgI583Z5uez3jBX5ylgR7oFTSwCIv5zsuYGGiBpDn-OBPmvEVyxIcT2dZC5WD82AMRjUrTy4wFquZReeuIxminMTqocWBl2v4Pu8uLvcEnH-Tv9qa8MtgXcU0a-xELWGulqe2UAUv_3Mi0Wb20QMgURcFaFcT7ccZXX_xHsrsboKavS7H_bWhEcwR3FvXKt1YwY3zDXiUHZaxjqGTqrv0V8wDFSZmnVFapT5RRH2tarYOmuKwv3MbdaXT0ZHBvQ2S2fBzOZ47WaTiTv9sKB-N8am94J3I_bo15dCauOm_bXZGT5ybbuBAp23D3297ARIYl74Xf_MJcapKA
</span></span></code></pre></div><p><strong>Payload:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;aud&#34;</span>: <span style="color:#e6db74">&#34;https://example.org/&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;azd&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;action&#34;</span>: <span style="color:#e6db74">&#34;Buy&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;stock&#34;</span>: <span style="color:#e6db74">&#34;NASDAQ:MSFT&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;exp&#34;</span>: <span style="color:#ae81ff">1715230133</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;iat&#34;</span>: <span style="color:#ae81ff">1715230118</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;iss&#34;</span>: <span style="color:#e6db74">&#34;https://example.org/tts&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;purp&#34;</span>: <span style="color:#e6db74">&#34;stocks.trade&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;rctx&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;req_ip&#34;</span>: <span style="color:#e6db74">&#34;192.128.0.89&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;sub&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;sherlock@detect.com&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;format&#34;</span>: <span style="color:#e6db74">&#34;email&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;txn&#34;</span>: <span style="color:#e6db74">&#34;e34025b9-2624-4f5d-bd1a-83def8379ebe&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Verification of TraTs involves validating both its signature and claims.</p>
<h4 id="verifying-signature">
  Verifying Signature
  <a href="#verifying-signature">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h4>
<p>Signature verification ensures the token is from Tratteria and has not been altered. For this guide, we can verify the signature using the obtained JWKS from the <code>GET .well-known/jwks.json</code> endpoint with tools like <a href="https://jwt.io/" target="_blank" rel="noopener">jwt.io</a> or other available methods. For <a href="https://jwt.io/" target="_blank" rel="noopener">jwt.io</a>, input the key from the JWKS keys list, i.e <code>{&quot;keys&quot;:[</code><em><strong><code>{this-section}</code></strong></em><code>]}</code> in the verify signature section.</p>
<h4 id="verifying-claims">
  Verifying Claims
  <a href="#verifying-claims">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h4>
<p>TraT contains the following verifiable claims:</p>
<p><strong>iss</strong></p>
<p>The issuer should match the Tratteria issuer value. In the generated TraT, we received <code>https://example.org/tts</code> as the issuer, which is the correct value as configured in the quick-start configuration.</p>
<p><strong>aud</strong></p>
<p>The audience should match the trust domain of your application. In the generated TraT, we received <code>https://example.org/</code> as the audience, which is the correct value as configured in the quick-start configuration.</p>
<p><strong>iat</strong></p>
<p>The issued at time. This should not be in the future.</p>
<p><strong>exp</strong></p>
<p>The expiration time. This should not be in the past.</p>
<p><strong>sub</strong></p>
<p>The identifier of the individual, entity, or user involved in the transaction. In the generated TraT, we received the following <code>sub</code> claim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;sub&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;format&#34;</span>: <span style="color:#e6db74">&#34;email&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;sherlock@detect.com&#34;</span>
</span></span><span style="display:flex;"><span>  }<span style="color:#960050;background-color:#1e0010">,</span>
</span></span></code></pre></div><p>Verifying the subject involves ensuring that the subject of the TraT matches the subject of the request.</p>
<p><strong>azd</strong></p>
<p>Authorization context of the transaction. In the generated TraT, we received the following <code>adz</code> claim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;azd&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;action&#34;</span>: <span style="color:#e6db74">&#34;Buy&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;stock&#34;</span>: <span style="color:#e6db74">&#34;NASDAQ:MSFT&#34;</span>
</span></span><span style="display:flex;"><span>  }<span style="color:#960050;background-color:#1e0010">,</span>
</span></span></code></pre></div><p>Validating the authorization context involves comparing the TraT&rsquo;s <code>azd</code> JSON claims against the parameters of the received request. For instance, if the request specifies Microsoft as the stock parameter, then the same should be there in the parameters present in the <code>adz</code> JSON.</p>
<p><strong>rctx</strong></p>
<p>The request context provides details about the environmental context of the request, including the IP address, authentication method, and workloads involved in the request chain. In the generated TraT, we received the following <code>rctx</code> claim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;rctx&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;req_ip&#34;</span>: <span style="color:#e6db74">&#34;192.128.0.89&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;authn&#34;</span>: <span style="color:#e6db74">&#34;urn:ietf:params:oauth:token-type:self_signed&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;req_wl&#34;</span>: [<span style="color:#e6db74">&#34;apigateway.example.org&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Verifying request context involves the following:</p>
<p><strong>req_ip</strong></p>
<p>Originating user IP address. Depending on your application or requirements, you can validate the IP address against rules such as the correct IP range.</p>
<p><strong>authn</strong></p>
<p>This denotes the method used to authenticate the requester. You should confirm that the authentication method used is acceptable. In this instance, we received <code>urn:ietf:params:oauth:token-type:self_signed</code>, indicating that the subject token is self-signed, which is the correct authn value for the quick-start configuration.</p>
<p><strong>req_wl</strong></p>
<p>These are the workloads that have requested this TraT. Using this list you should ensure that the request has passed through the approved and required services, thereby maintaining the integrity of the call chain.</p>
<p> </p>
<p>As an application developer, you should verify both the signature and the claims before processing the request. You can use <a href="#">this library</a> to verify TraTs. Currently, the library is only available in Go.</p>
<p> </p>
<p>This quick start guide provides the basic steps to get Tratteria up and running for initial learning and evaluation purposes. Remember to adjust the configurations as per the requirements for any setup beyond initial evaluations. Check <a href="#">this guide</a> for detailed instructions on configuring and integrating production-level Tratteria.</p>

</div>


        </section>
        <section class="col d-none d-lg-block">
          



  <div class="toc">
    <p> On this page:</p>
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#accessing-tratterias-public-key-json-web-key-sets-jwks">Accessing Tratteria&rsquo;s Public Key JSON Web Key Sets (JWKS)</a></li>
        <li><a href="#verifing-trats">Verifing TraTs</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>


        </section>

      </section>
    </div>

    </main>
    



<footer class="text-light bg-dark" style="padding: 20px 0; text-align: center;">
  <div class="footer">
    <p>Tratteria is an open-source project sponsored by <a href="https://www.sgnl.ai" target="_blank">SGNL.ai</a></p>
  </div>
  
  <div class="container">

    <div style="margin-bottom: 20px;">
      <i class="fab fa-github" style="font-size: 24px;"></i>
    </div>

    
    <div style="margin-bottom: 20px;">
      


<a class="btn text-light" style="background-color: #000000" href="https://github.com/SGNL-ai/Tratteria">
    
    <span class="icon">
      <i class="fab fa-github"></i>
    </span>
    
    
      GitHub
    
  </a>


    </div>
    

    <p style="margin-top: 20px;">
      &copy; 2024 SGNL.ai, Inc.
    </p>
  </div>
</footer>
  </body>
</html>
